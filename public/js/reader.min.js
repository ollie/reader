(function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function e(){this._handleMarkAsUnreadClick=t(this._handleMarkAsUnreadClick,this),this._handleMarkAsReadClick=t(this._handleMarkAsReadClick,this),this._handleItemClick=t(this._handleItemClick,this),this._handleChannelClick=t(this._handleChannelClick,this),this._handleScrollLinkClick=t(this._handleScrollLinkClick,this);var e;this.htmlBody=$("html, body"),this.scrollLink=$("#scroll-link"),this.anchor=$("#anchor"),this.channelsWrapper=$("#channels-wrapper"),this.itemsWrapper=$("#items-wrapper"),this.markChannelAsReadLink=$("#mark-channel-as-read-link"),this.syncChannelLink=$("#sync-channel-link"),this.itemTitle=$("#item-title"),this.itemInfo=$("#item-info"),this.itemContent=$("#item-content"),this.itemMarkAsRead=$(".js-item-mark-as-read"),this.itemMarkAsUnread=$(".js-item-mark-as-unread"),e=$("#item-template"),this.itemTemplate=Hogan.compile(e.html()),this.activeChannel=this.channelsWrapper.find(".js-active"),this.activeItem=this.itemsWrapper.find(".js-active"),this.scrollLink.on("click",this._handleScrollLinkClick),this.channelsWrapper.on("click",".js-link",this._handleChannelClick),this.itemsWrapper.on("click",".js-link",this._handleItemClick),this.itemMarkAsRead.on("click",this._handleMarkAsReadClick),this.itemMarkAsUnread.on("click",this._handleMarkAsUnreadClick)}return e.prototype._handleScrollLinkClick=function(){return this._scrollToAnchor()},e.prototype._handleChannelClick=function(e){var t,a;return e.preventDefault(),a=$(e.currentTarget),t=a.parent(),$.ajax({url:a.attr("href"),dataType:"json",success:function(e){return function(a){var n;return e.activeChannel.removeClass("js-active"),e.activeChannel.find("a").removeClass("bg-lighter"),t.addClass("js-active"),t.find("a").addClass("bg-lighter"),e.markChannelAsReadLink.attr("href",a.mark_channel_as_read_url),e.syncChannelLink.attr("href",a.sync_channel_url),e._renderItems(a.items),n=a.item,e.itemTitle.text(n.title).attr("href",n.link),e.itemInfo.text(n.info),e.itemMarkAsRead.attr("href",n.mark_as_read_url),e.itemMarkAsUnread.attr("href",n.mark_as_unread_url),n.read?(e.itemMarkAsRead.addClass("d-none"),e.itemMarkAsUnread.removeClass("d-none")):(e.itemMarkAsUnread.addClass("d-none"),e.itemMarkAsRead.removeClass("d-none")),e.itemContent.html(n.description),e.activeChannel=t,e.activeItem=e.itemsWrapper.find(".js-active")}}(this)})},e.prototype._handleItemClick=function(e){var t,a;return e.preventDefault(),a=$(e.currentTarget),t=a.parent(),$.ajax({url:a.attr("href"),dataType:"json",success:function(e){return function(a){return e.activeItem.removeClass("js-active"),e.activeItem.find("a").removeClass("bg-lighter"),t.addClass("js-active"),t.find("a").addClass("bg-lighter"),e.itemTitle.text(a.title).attr("href",a.link),e.itemInfo.text(a.info),e.itemMarkAsRead.attr("href",a.mark_as_read_url),e.itemMarkAsUnread.attr("href",a.mark_as_unread_url),a.read?(e.itemMarkAsRead.addClass("d-none"),e.itemMarkAsUnread.removeClass("d-none")):(e.itemMarkAsUnread.addClass("d-none"),e.itemMarkAsRead.removeClass("d-none")),e.itemContent.html(a.description),e._scrollToTop(),e.activeItem=t}}(this)})},e.prototype._handleMarkAsReadClick=function(e){var t;return e.preventDefault(),t=$(e.currentTarget),$.ajax({url:t.attr("href"),method:"patch",success:function(e){return function(t){var a,n;return e.itemMarkAsRead.addClass("d-none"),e.itemMarkAsUnread.removeClass("d-none"),a=e.activeChannel.find(".js-counter"),n=Number(a.text())-1,a.text(n),0===n&&a.addClass("d-none"),e.activeItem.removeClass("font-weight-bold"),e.activeItem.find("a").removeClass("text-dark").addClass("text-secondary")}}(this)})},e.prototype._handleMarkAsUnreadClick=function(e){var t;return e.preventDefault(),t=$(e.currentTarget),$.ajax({url:t.attr("href"),method:"patch",success:function(e){return function(t){var a,n;return e.itemMarkAsUnread.addClass("d-none"),e.itemMarkAsRead.removeClass("d-none"),a=e.activeChannel.find(".js-counter"),n=Number(a.text())+1,a.text(n),0!==n&&a.removeClass("d-none"),e.activeItem.addClass("font-weight-bold"),e.activeItem.find("a").removeClass("text-secondary").addClass("text-dark")}}(this)})},e.prototype._renderItems=function(e){var t,a,n,r,i;for(t="",n=a=0,i=e.length;a<i;n=++a)r=e[n],t+=this.itemTemplate.render({active:0===n,item_url:r.item_url,title:r.title,read:r.read}),t+="\n";return this.itemsWrapper.html(t)},e.prototype._scrollToTop=function(){if(this._isSmallDevice())return this.htmlBody.animate({scrollTop:0},250)},e.prototype._scrollToAnchor=function(){var e,t;return t=this.anchor.offset().top,$(window).height(),e=t,this.htmlBody.animate({scrollTop:e},250)},e.prototype._isSmallDevice=function(){return this.scrollLink.is(":visible")},e}(),$(function(){return new e})}).call(this);